<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cleanroom DataLog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBQVm5-PrEojIObPC5t2H0ErHM4H2lTOWE",
            authDomain: "sistema-monitoramento-anvisa.firebaseapp.com",
            projectId: "sistema-monitoramento-anvisa",
            storageBucket: "sistema-monitoramento-anvisa.firebasestorage.app",
            messagingSenderId: "551458347466",
            appId: "1:551458347466:web:541f0b0f77e4faa67c5733"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        console.log('Firebase inicializado!');
    </script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            font-size: 14px;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--primary);
            color: white;
            transition: all 0.3s;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 20px;
            background-color: rgba(0,0,0,0.2);
            text-align: center;
            position: sticky;
            top: 0;
            background-color: var(--primary);
        }
        
        .sidebar-menu {
            padding: 15px 0;
        }
        
        .menu-item {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .menu-item:hover {
            background-color: rgba(255,255,255,0.1);
        }
        
        .menu-item.active {
            background-color: var(--secondary);
            border-left: 4px solid white;
        }
        
        .menu-item i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            margin-left: 250px;
            width: calc(100% - 250px);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .user-role {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            background-color: var(--success);
            color: white;
            margin-left: 10px;
        }
        
        .user-role.admin {
            background-color: var(--warning);
        }
        
        /* Cards */
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            flex-wrap: wrap;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--secondary);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }
        
        .form-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .section-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background-color: #219653;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c0392b;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 13px;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--primary);
        }
        
        tr:hover {
            background-color: #f5f5f5;
        }
        
        /* Status indicators */
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .status-normal {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-alert {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-critical {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background-color: #f8f9fa;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Page Content */
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            color: var(--primary);
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                margin-left: 200px;
                width: calc(100% - 200px);
            }
            
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                z-index: 1000;
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                padding: 10px 0;
            }
            
            .menu-item {
                flex: 1;
                min-width: 120px;
                justify-content: center;
                border-left: none;
                border-top: 4px solid transparent;
                padding: 12px 10px;
                font-size: 12px;
                flex-direction: column;
                text-align: center;
            }
            
            .menu-item i {
                margin-right: 0;
                margin-bottom: 5px;
                font-size: 16px;
            }
            
            .menu-item.active {
                border-left: none;
                border-top: 4px solid white;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                padding: 10px 0;
            }
            
            .user-info {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .card-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: flex-start;
                flex-wrap: wrap;
            }
            
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 12px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
                margin-bottom: 5px;
            }
            
            .btn-sm {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .card {
                padding: 12px;
                margin-bottom: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }
            
            .card {
                padding: 10px;
            }
            
            .sidebar-header h2 {
                font-size: 18px;
            }
            
            .sidebar-header p {
                font-size: 12px;
            }
            
            .page-title {
                font-size: 18px;
            }
            
            .user-avatar {
                width: 35px;
                height: 35px;
            }
            
            .user-role {
                font-size: 10px;
                padding: 2px 6px;
            }
        }
        
        /* Hidden elements for non-admin users */
        .admin-only {
            display: none;
        }
        
        .user-admin .admin-only {
            display: block;
        }
        
        .user-admin .admin-only-inline {
            display: inline-block;
        }
        
        /* Edit Modal */
        .edit-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .edit-modal-content {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .edit-modal-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--primary);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal" id="login-modal">
    <div class="modal-content">
        <div class="modal-title">Login do Sistema</div>
        <div class="form-group">
            <label for="login-email">Email:</label>
            <input type="email" id="login-email" placeholder="seu@email.com">
        </div>
        <div class="form-group">
            <label for="login-password">Senha:</label>
            <input type="password" id="login-password" placeholder="Sua senha">
        </div>
        <div id="login-error" style="color: red; margin-bottom: 15px; display: none;"></div>
        <button class="btn btn-primary" id="login-btn" style="width: 100%;">
            <i class="fas fa-sign-in-alt"></i> Entrar
        </button>
        <div style="margin-top: 15px; text-align: center; font-size: 12px; color: #666;">
            <!-- Informações adicionais podem ser adicionadas aqui -->
        </div>
    </div>
</div>
    
    <!-- Edit Modal -->
    <div class="edit-modal" id="edit-modal">
        <div class="edit-modal-content">
            <div class="edit-modal-title" id="edit-modal-title">Editar Registro</div>
            <div id="edit-modal-content">
                <!-- Conteúdo dinâmico será inserido aqui -->
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" id="cancel-edit-btn">Cancelar</button>
                <button class="btn btn-primary" id="save-edit-btn">Salvar</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-clinic-medical"></i> Clean DataLog</h2>
                <p>Sistema de Monitoramento</p>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-page="temperature">
                    <i class="fas fa-thermometer-half"></i>
                    <span>Temperatura & Umidade</span>
                </div>
                <div class="menu-item" data-page="pressure">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Pressão</span>
                </div>
                <div class="menu-item" data-page="osmosis">
                    <i class="fas fa-tint"></i>
                    <span>Sistema de Osmose</span>
                </div>
                <div class="menu-item admin-only" data-page="rooms">
                    <i class="fas fa-door-open"></i>
                    <span>Gerenciar Salas</span>
                </div>
                <div class="menu-item admin-only" data-page="users">
                    <i class="fas fa-users"></i>
                    <span>Gerenciar Usuários</span>
                </div>
                <div class="menu-item admin-only" data-page="traceability">
                    <i class="fas fa-history"></i>
                    <span>Rastreabilidade</span>
                </div>
                <div class="menu-item admin-only" data-page="reports">
                    <i class="fas fa-file-pdf"></i>
                    <span>Relatórios</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div class="page-title">Monitoramento de Ambiente</div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div>Operador: <span id="current-user">Usuário</span></div>
                        <div style="font-size: 12px; color: var(--gray);">Último login: <span id="last-login">--:--</span></div>
                    </div>
                    <div class="user-role" id="user-role">Usuário</div>
                    <button class="btn btn-warning btn-sm" id="logout-btn" style="margin-left: 10px;">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </div>
            
            <!-- Temperature & Humidity Page -->
            <div class="page-content active" id="temperature-page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Registro de Temperatura e Umidade</div>
                        <div class="current-time" id="current-time">Carregando data/hora...</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="room-select">Selecione a Sala:</label>
                        <select id="room-select">
                            <option value="">Carregando salas...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="periodo">Período:</label>
                        <select id="periodo">
                            <option value="manha">Manhã</option>
                            <option value="tarde">Tarde</option>
                        </select>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">Temperatura</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="temp-min">Temperatura Mínima (°C):</label>
                                <input type="number" id="temp-min" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="temp-max">Temperatura Máxima (°C):</label>
                                <input type="number" id="temp-max" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="temp-atual">Temperatura Atual (°C):</label>
                                <input type="number" id="temp-atual" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">Umidade</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="umid-min">Umidade Mínima (%):</label>
                                <input type="number" id="umid-min" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="umid-max">Umidade Máxima (%):</label>
                                <input type="number" id="umid-max" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="umid-atual">Umidade Atual (%):</label>
                                <input type="number" id="umid-atual" step="0.1">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="temp-notes">Observações:</label>
                        <textarea id="temp-notes" rows="3" placeholder="Adicione observações se necessário..."></textarea>
                    </div>
                    
                    <button class="btn btn-primary" id="save-temp-btn">
                        <i class="fas fa-save"></i> Registrar Leitura
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Histórico de Temperatura e Umidade</div>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm admin-only" id="export-temp-pdf">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Sala</th>
                                    <th>Período</th>
                                    <th>Temp. Mín</th>
                                    <th>Temp. Máx</th>
                                    <th>Temp. Atual</th>
                                    <th>Umid. Mín</th>
                                    <th>Umid. Máx</th>
                                    <th>Umid. Atual</th>
                                    <th>Status</th>
                                    <th>Operador</th>
                                    <th class="admin-only">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="temp-history">
                                <tr>
                                    <td colspan="12" style="text-align: center;">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Pressure Page -->
            <div class="page-content" id="pressure-page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Registro de Pressão</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pressure-room">Selecione a Sala:</label>
                        <select id="pressure-room">
                            <option value="">Carregando salas...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="pressure-value">Pressão (Pa):</label>
                        <input type="number" id="pressure-value" step="1">
                    </div>
                    
                    <div class="form-group">
                        <label for="correcao-imediata">Correção Imediata:</label>
                        <textarea id="correcao-imediata" rows="3" placeholder="Descreva a correção realizada, se aplicável..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="pressure-notes">Observações:</label>
                        <textarea id="pressure-notes" rows="3" placeholder="Adicione observações se necessário..."></textarea>
                    </div>
                    
                    <button class="btn btn-primary" id="save-pressure-btn">
                        <i class="fas fa-save"></i> Registrar Pressão
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Histórico de Pressão</div>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm admin-only" id="export-pressure-pdf">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Sala</th>
                                    <th>Pressão (Pa)</th>
                                    <th>Correção Imediata</th>
                                    <th>Status</th>
                                    <th>Operador</th>
                                    <th class="admin-only">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="pressure-history">
                                <tr>
                                    <td colspan="7" style="text-align: center;">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Osmosis Page -->
            <div class="page-content" id="osmosis-page">
                <div class="tabs">
                    <div class="tab active" data-tab="daily">Controle Diário</div>
                    <div class="tab" data-tab="maintenance">Controle de Manutenção</div>
                </div>
                
                <!-- Daily Control Tab -->
                <div id="daily-tab" class="tab-content active">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Controle Diário do Sistema de Osmose Reversa</div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">1. Condutividade da Água Purificada</div>
                            <div class="form-group">
                                <label for="condutividade">Resultado observado no condutivímetro de linha (µS/cm):</label>
                                <input type="number" id="condutividade" step="0.1">
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">2. Sanitização do Sistema de Osmose Reversa ou Downtime</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ultima-sanitizacao">Data da última sanitização/downtime:</label>
                                    <input type="date" id="ultima-sanitizacao">
                                </div>
                                
                                <div class="form-group">
                                    <label for="proxima-sanitizacao">Data prevista para a próxima sanitização/downtime:</label>
                                    <input type="date" id="proxima-sanitizacao">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">3. Higienização</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ultima-higienizacao">Data da última higienização:</label>
                                    <input type="date" id="ultima-higienizacao">
                                </div>
                                
                                <div class="form-group">
                                    <label for="proxima-higienizacao">Data prevista para a próxima higienização:</label>
                                    <input type="date" id="proxima-higienizacao">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">4. Coleta de Água para Análise</div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ultima-coleta">Data da última coleta:</label>
                                    <input type="date" id="ultima-coleta">
                                </div>
                                
                                <div class="form-group">
                                    <label for="proxima-coleta">Data prevista para a próxima coleta:</label>
                                    <input type="date" id="proxima-coleta">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">5. O equipamento apresenta alguma anormalidade no funcionamento?</div>
                            <div class="checkbox-group">
                                <input type="radio" id="anormalidade-sim" name="anormalidade" value="sim">
                                <label for="anormalidade-sim">Sim</label>
                            </div>
                            <div class="checkbox-group">
                                <input type="radio" id="anormalidade-nao" name="anormalidade" value="nao" checked>
                                <label for="anormalidade-nao">Não</label>
                            </div>
                            
                            <div class="form-group" id="anormalidade-detalhes" style="display: none;">
                                <label for="motivo-anormalidade">Descreva o motivo:</label>
                                <textarea id="motivo-anormalidade" rows="3" placeholder="Descreva a anormalidade observada..."></textarea>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">6. Troca de Filtros</div>
                            
                            <div class="form-group">
                                <label>Data da última troca:</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ultima-fpp001">FPP-001:</label>
                                        <input type="date" id="ultima-fpp001">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="ultima-fca001">FCA-001:</label>
                                        <input type="date" id="ultima-fca001">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="ultima-drm001">DRM-001:</label>
                                        <input type="date" id="ultima-drm001">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="ultima-drm002">DRM-002:</label>
                                        <input type="date" id="ultima-drm002">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Data prevista para a próxima troca:</label>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="proxima-fpp001">FPP-001:</label>
                                        <input type="date" id="proxima-fpp001">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="proxima-fca001">FCA-001:</label>
                                        <input type="date" id="proxima-fca001">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="proxima-drm001">DRM-001:</label>
                                        <input type="date" id="proxima-drm001">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="proxima-drm002">DRM-002:</label>
                                        <input type="date" id="proxima-drm002">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="osmosis-daily-notes">Observações:</label>
                            <textarea id="osmosis-daily-notes" rows="3" placeholder="Adicione observações sobre o sistema de osmose..."></textarea>
                        </div>
                        
                        <button class="btn btn-primary" id="save-osmosis-daily-btn">
                            <i class="fas fa-save"></i> Registrar Controle Diário
                        </button>
                    </div>
                </div>
                
                <!-- Maintenance Control Tab -->
                <div id="maintenance-tab" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Controle de Manutenção do Sistema de Osmose Reversa</div>
                        </div>
                        
                        <div class="form-group">
                            <label for="procedimento">Procedimento Realizado:</label>
                            <textarea id="procedimento" rows="3" placeholder="Descreva o procedimento de manutenção realizado..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="data-manutencao">Data da Manutenção:</label>
                            <input type="date" id="data-manutencao">
                        </div>
                        
                        <div class="form-group">
                            <label for="obs-manutencao">Observações:</label>
                            <textarea id="obs-manutencao" rows="3" placeholder="Adicione observações sobre a manutenção..."></textarea>
                        </div>
                        
                        <button class="btn btn-primary" id="save-osmosis-maintenance-btn">
                            <i class="fas fa-save"></i> Registrar Manutenção
                        </button>
                    </div>

                    <div class="card admin-only">
                        <div class="card-header">
                            <div class="card-title">Histórico de Manutenções</div>
                            <div class="card-actions">
                                <button class="btn btn-success btn-sm" id="export-maintenance-pdf">
                                    <i class="fas fa-file-pdf"></i> Exportar PDF
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Procedimento</th>
                                        <th>Observações</th>
                                        <th>Operador</th>
                                        <th class="admin-only">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="maintenance-history">
                                    <tr>
                                        <td colspan="5" style="text-align: center;">Carregando dados...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="card admin-only">
                    <div class="card-header">
                        <div class="card-title">Histórico de Osmose - Controles Diários</div>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm" id="export-osmosis-pdf">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Condutividade</th>
                                    <th>Anormalidade</th>
                                    <th>Operador</th>
                                    <th class="admin-only">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="osmosis-history">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Rooms Page -->
            <div class="page-content" id="rooms-page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Adicionar Nova Sala</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="room-name">Nome da Sala:</label>
                            <input type="text" id="room-name" placeholder="Ex: Sala 05 - Qualidade">
                        </div>
                        
                        <div class="form-group">
                            <label for="room-code">Código da Sala:</label>
                            <input type="text" id="room-code" placeholder="Ex: SALA05">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="room-type">Tipo de Sala:</label>
                            <select id="room-type">
                                <option value="estoque">Estoque</option>
                                <option value="preparacao">Preparação</option>
                                <option value="producao">Produção</option>
                                <option value="embalagem">Embalagem</option>
                                <option value="qualidade">Controle de Qualidade</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="room-responsible">Responsável:</label>
                            <input type="text" id="room-responsible" placeholder="Nome do responsável">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">Parâmetros de Temperatura</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="temp-min-room">Temperatura Mínima (°C):</label>
                                <input type="number" id="temp-min-room" step="0.1" placeholder="Ex: 18.0" value="18.0">
                            </div>
                            <div class="form-group">
                                <label for="temp-max-room">Temperatura Máxima (°C):</label>
                                <input type="number" id="temp-max-room" step="0.1" placeholder="Ex: 26.0" value="26.0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="section-title">Parâmetros de Umidade</div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="umid-min-room">Umidade Mínima (%):</label>
                                <input type="number" id="umid-min-room" step="0.1" placeholder="Ex: 40.0" value="40.0">
                            </div>
                            <div class="form-group">
                                <label for="umid-max-room">Umidade Máxima (%):</label>
                                <input type="number" id="umid-max-room" step="0.1" placeholder="Ex: 60.0" value="60.0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pressure-value-min">Pressão deve ser maior ou igual a (Pa):</label>
                        <input type="number" id="pressure-value-min" placeholder="Ex: 5" value="5">
                    </div>
                    
                    <div class="form-group">
                        <label for="room-description">Descrição:</label>
                        <textarea id="room-description" rows="3" placeholder="Descreva a finalidade da sala..."></textarea>
                    </div>
                    
                    <button class="btn btn-success" id="add-room-btn">
                        <i class="fas fa-plus"></i> Adicionar Sala
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Salas Cadastradas</div>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm" id="export-rooms-pdf">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Nome</th>
                                    <th>Tipo</th>
                                    <th>Responsável</th>
                                    <th>Temp. Min-Max</th>
                                    <th>Umid. Min-Max</th>
                                    <th>Pressão Mínima</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="rooms-list">
                                <tr>
                                    <td colspan="9" style="text-align: center;">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Management Page -->
            <div class="page-content" id="users-page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Adicionar Novo Usuário</div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="user-name">Nome Completo:</label>
                            <input type="text" id="user-name" placeholder="Nome do usuário">
                        </div>
                        
                        <div class="form-group">
                            <label for="user-email">Email:</label>
                            <input type="email" id="user-email" placeholder="email@empresa.com">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="user-password">Senha:</label>
                            <input type="password" id="user-password" placeholder="Senha temporária">
                        </div>
                        
                        <div class="form-group">
                            <label for="user-role">Tipo de Usuário:</label>
                            <select id="user-role">
                                <option value="user">Usuário Normal</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" id="add-user-btn">
                        <i class="fas fa-user-plus"></i> Adicionar Usuário
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Usuários do Sistema</div>
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Tipo</th>
                                    <th>Data de Criação</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="users-list">
                                <tr>
                                    <td colspan="6" style="text-align: center;">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Traceability Page -->
            <div class="page-content" id="traceability-page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Rastreabilidade do Sistema</div>
                        <div class="card-actions admin-only">
                            <button class="btn btn-success btn-sm" id="export-traceability-pdf">
                                <i class="fas fa-file-pdf"></i> Exportar PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="filter-date">Filtrar por Data:</label>
                            <input type="date" id="filter-date">
                        </div>
                        
                        <div class="form-group">
                            <label for="filter-user">Filtrar por Usuário:</label>
                            <select id="filter-user">
                                <option value="all">Todos</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="filter-action">Filtrar por Ação:</label>
                            <select id="filter-action">
                                <option value="all">Todas</option>
                                <option value="temperature">Temperatura/Umidade</option>
                                <option value="pressure">Pressão</option>
                                <option value="osmosis">Osmose</option>
                                <option value="room">Sala</option>
                                <option value="user">Usuário</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Usuário</th>
                                    <th>Ação</th>
                                    <th>Detalhes</th>
                                    <th>IP</th>
                                </tr>
                            </thead>
                            <tbody id="traceability-log">
                                <tr>
                                    <td colspan="5" style="text-align: center;">Carregando dados...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Reports Page -->
            <div class="page-content" id="reports-page">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Relatórios do Sistema</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="report-type">Tipo de Relatório:</label>
                        <select id="report-type">
                            <option value="temperature">Temperatura e Umidade</option>
                            <option value="pressure">Pressão</option>
                            <option value="osmosis">Sistema de Osmose</option>
                            <option value="rooms">Salas</option>
                            <option value="users">Usuários</option>
                            <option value="traceability">Rastreabilidade</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="report-start-date">Data Inicial:</label>
                            <input type="date" id="report-start-date">
                        </div>
                        
                        <div class="form-group">
                            <label for="report-end-date">Data Final:</label>
                            <input type="date" id="report-end-date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="report-format">Formato do Relatório:</label>
                        <select id="report-format">
                            <option value="pdf">PDF</option>
                            <option value="csv">CSV</option>
                        </select>
                    </div>
                    
                    <button class="btn btn-success" id="generate-report-btn">
                        <i class="fas fa-file-export"></i> Gerar Relatório
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado global da aplicação
        let currentUser = null;
        let rooms = [];
        let allUsers = [];
        let currentEditData = null;

        // Inicializar aplicação
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        async function initializeApp() {
            console.log('Inicializando aplicação...');
            
            // Verificar se usuário já está logado
            auth.onAuthStateChanged(async (user) => {
                console.log('Estado de autenticação alterado:', user);
                if (user) {
                    await handleUserLogin(user);
                } else {
                    showLoginModal();
                }
            });

            // Configurar event listeners
            setupEventListeners();
            setupOsmosisTabs();
            
            // Atualizar hora atual
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
        }

        function setupEventListeners() {
            // Login
            document.getElementById('login-btn').addEventListener('click', handleLogin);
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', handleLogout);
            
            // Navegação
            const menuItems = document.querySelectorAll('.menu-item');
            const pages = document.querySelectorAll('.page-content');
            
            menuItems.forEach(item => {
                item.addEventListener('click', function() {
                    if (this.classList.contains('admin-only') && currentUser && currentUser.role !== 'admin') {
                        alert('Apenas administradores podem acessar esta funcionalidade.');
                        return;
                    }
                    
                    const targetPage = this.getAttribute('data-page');
                    
                    // Update active menu item
                    menuItems.forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show target page
                    pages.forEach(page => {
                        page.classList.remove('active');
                        if (page.id === `${targetPage}-page`) {
                            page.classList.add('active');
                        }
                    });
                    
                    // Update page title
                    updatePageTitle(targetPage);

                    // Carregar dados específicos da página
                    if (targetPage === 'users') {
                        loadUsersList();
                    } else if (targetPage === 'rooms') {
                        loadRoomsList();
                    } else if (targetPage === 'traceability') {
                        loadTraceabilityLog();
                    }
                });
            });

            // Salvar dados
            document.getElementById('save-temp-btn').addEventListener('click', saveTemperatureData);
            document.getElementById('save-pressure-btn').addEventListener('click', savePressureData);
            document.getElementById('save-osmosis-daily-btn').addEventListener('click', saveOsmosisDaily);
            document.getElementById('save-osmosis-maintenance-btn').addEventListener('click', saveOsmosisMaintenance);
            document.getElementById('add-room-btn').addEventListener('click', addRoom);
            document.getElementById('add-user-btn').addEventListener('click', addUser);

            // Toggle anormalidade
            document.getElementById('anormalidade-sim').addEventListener('change', function() {
                document.getElementById('anormalidade-detalhes').style.display = this.checked ? 'block' : 'none';
            });
            
            document.getElementById('anormalidade-nao').addEventListener('change', function() {
                document.getElementById('anormalidade-detalhes').style.display = this.checked ? 'none' : 'block';
            });

            // Exportar PDF
            document.getElementById('export-temp-pdf').addEventListener('click', () => exportToPDF('temperature'));
            document.getElementById('export-pressure-pdf').addEventListener('click', () => exportToPDF('pressure'));
            document.getElementById('export-osmosis-pdf').addEventListener('click', () => exportToPDF('osmosis'));
            document.getElementById('export-maintenance-pdf').addEventListener('click', () => exportToPDF('maintenance'));
            document.getElementById('export-rooms-pdf').addEventListener('click', () => exportToPDF('rooms'));
            document.getElementById('export-traceability-pdf').addEventListener('click', () => exportToPDF('traceability'));
            document.getElementById('generate-report-btn').addEventListener('click', generateReport);

            // Filtros
            document.getElementById('filter-date').addEventListener('change', filterTraceability);
            document.getElementById('filter-user').addEventListener('change', filterTraceability);
            document.getElementById('filter-action').addEventListener('change', filterTraceability);

            // Edit Modal
            document.getElementById('cancel-edit-btn').addEventListener('click', hideEditModal);
            document.getElementById('save-edit-btn').addEventListener('click', saveEdit);
        }

        function setupOsmosisTabs() {
            const tabs = document.querySelectorAll('#osmosis-page .tab');
            const tabContents = document.querySelectorAll('#osmosis-page .tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    document.getElementById(`${targetTab}-tab`).classList.add('active');
                });
            });
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            const loginBtn = document.getElementById('login-btn');

            try {
                // Mostrar loading
                loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...';
                loginBtn.disabled = true;

                console.log('Tentando login com:', email);
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                console.log('Login bem-sucedido:', userCredential.user);
                await handleUserLogin(userCredential.user);
                
            } catch (error) {
                console.error('Erro no login:', error);
                errorDiv.textContent = getAuthErrorMessage(error.code);
                errorDiv.style.display = 'block';
            } finally {
                // Restaurar botão
                loginBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Entrar';
                loginBtn.disabled = false;
            }
        }

        async function handleUserLogin(user) {
            console.log('Processando login do usuário:', user.email);
            
            try {
                // Buscar dados do usuário no Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (userDoc.exists) {
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        ...userDoc.data()
                    };
                    console.log('Dados do usuário carregados:', currentUser);
                } else {
                    // Criar usuário padrão se não existir
                    console.log('Usuário não encontrado no Firestore, criando...');
                    currentUser = {
                        uid: user.uid,
                        email: user.email,
                        name: user.email.split('@')[0],
                        role: 'user',
                        createdAt: new Date()
                    };
                    
                    await db.collection('users').doc(user.uid).set(currentUser);
                }

                updateUI();
                await loadInitialData();
                hideLoginModal();
                
                // Registrar login no log de rastreabilidade
                await addTraceability('Login no sistema', `Usuário ${currentUser.name} fez login`);
                
            } catch (error) {
                console.error('Erro ao processar login:', error);
                alert('Erro ao carregar dados do usuário: ' + error.message);
            }
        }

        function handleLogout() {
            auth.signOut();
            currentUser = null;
            showLoginModal();
        }

        function updateUI() {
            document.getElementById('current-user').textContent = currentUser.name;
            document.getElementById('user-role').textContent = currentUser.role === 'admin' ? 'Administrador' : 'Usuário';
            document.getElementById('user-role').className = `user-role ${currentUser.role === 'admin' ? 'admin' : ''}`;
            document.getElementById('last-login').textContent = new Date().toLocaleTimeString('pt-BR');
            
            if (currentUser.role === 'admin') {
                document.body.classList.add('user-admin');
            } else {
                document.body.classList.remove('user-admin');
            }
        }

        function updatePageTitle(page) {
            const titles = {
                'temperature': 'Monitoramento de Temperatura e Umidade',
                'pressure': 'Monitoramento de Pressão',
                'osmosis': 'Sistema de Osmose',
                'rooms': 'Gerenciamento de Salas',
                'users': 'Gerenciamento de Usuários',
                'traceability': 'Rastreabilidade do Sistema',
                'reports': 'Relatórios do Sistema'
            };
            document.querySelector('.page-title').textContent = titles[page] || 'Sistema de Monitoramento';
        }

        async function loadInitialData() {
            try {
                // Carregar salas
                await loadRooms();
                
                // Carregar históricos
                loadTemperatureHistory();
                loadPressureHistory();
                loadOsmosisHistory();
                loadMaintenanceHistory();
                loadTraceabilityLog();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                alert('Erro ao carregar dados iniciais');
            }
        }

        async function loadRooms() {
            try {
                const roomsSnapshot = await db.collection('rooms')
                    .where('status', '==', 'active')
                    .get();
                
                rooms = [];
                roomsSnapshot.forEach(doc => {
                    rooms.push({ id: doc.id, ...doc.data() });
                });
                
                updateRoomsSelect();
                
            } catch (error) {
                console.error('Erro ao carregar salas:', error);
                // Continua mesmo com erro para não bloquear a aplicação
            }
        }

        function updateRoomsSelect() {
            const roomSelect = document.getElementById('room-select');
            const pressureRoomSelect = document.getElementById('pressure-room');
            
            roomSelect.innerHTML = '';
            pressureRoomSelect.innerHTML = '';
            
            if (rooms.length === 0) {
                roomSelect.innerHTML = '<option value="">Nenhuma sala cadastrada</option>';
                pressureRoomSelect.innerHTML = '<option value="">Nenhuma sala cadastrada</option>';
                return;
            }
            
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = `${room.code} - ${room.name}`;
                
                roomSelect.appendChild(option.cloneNode(true));
                pressureRoomSelect.appendChild(option);
            });
        }

        // ========== FUNÇÕES PARA SALVAR DADOS ==========

        async function saveTemperatureData() {
            if (!currentUser) return;
            
            const roomId = document.getElementById('room-select').value;
            const room = rooms.find(r => r.id === roomId);
            
            if (!room) {
                alert('Por favor, selecione uma sala válida.');
                return;
            }

            const tempMin = parseFloat(document.getElementById('temp-min').value);
            const tempMax = parseFloat(document.getElementById('temp-max').value);
            const tempActual = parseFloat(document.getElementById('temp-atual').value);
            const humidityMin = parseFloat(document.getElementById('umid-min').value);
            const humidityMax = parseFloat(document.getElementById('umid-max').value);
            const humidityActual = parseFloat(document.getElementById('umid-atual').value);

            // Validação
            if (isNaN(tempMin) || isNaN(tempMax) || isNaN(tempActual) || 
                isNaN(humidityMin) || isNaN(humidityMax) || isNaN(humidityActual)) {
                alert('Por favor, preencha todos os campos obrigatórios com valores numéricos válidos.');
                return;
            }

            const data = {
                roomId: roomId,
                roomName: `${room.code} - ${room.name}`,
                period: document.getElementById('periodo').value,
                tempMin: tempMin,
                tempMax: tempMax,
                tempActual: tempActual,
                humidityMin: humidityMin,
                humidityMax: humidityMax,
                humidityActual: humidityActual,
                notes: document.getElementById('temp-notes').value,
                status: calculateTemperatureStatus(
                    tempActual,
                    humidityActual,
                    room.tempMin,
                    room.tempMax,
                    room.humidityMin,
                    room.humidityMax
                ),
                userId: currentUser.uid,
                userName: currentUser.name,
                createdAt: new Date()
            };

            try {
                await db.collection('temperature_readings').add(data);
                await addTraceability(
                    'Registro de temperatura', 
                    `${data.roomName} (${data.period}): Temp: ${data.tempMin}-${data.tempMax}°C, Umid: ${data.humidityMin}-${data.humidityMax}%`
                );
                
                alert('Dados de temperatura registrados com sucesso!');
                clearTemperatureForm();
                loadTemperatureHistory();
                
            } catch (error) {
                console.error('Erro ao salvar temperatura:', error);
                alert('Erro ao salvar dados de temperatura: ' + error.message);
            }
        }

        async function savePressureData() {
            if (!currentUser) return;
            
            const roomId = document.getElementById('pressure-room').value;
            const room = rooms.find(r => r.id === roomId);
            
            if (!room) {
                alert('Por favor, selecione uma sala válida.');
                return;
            }

            const pressureValue = parseInt(document.getElementById('pressure-value').value);

            if (isNaN(pressureValue)) {
                alert('Por favor, preencha o campo de pressão com um valor numérico válido.');
                return;
            }

            const data = {
                roomId: roomId,
                roomName: `${room.code} - ${room.name}`,
                pressure: pressureValue,
                immediateCorrection: document.getElementById('correcao-imediata').value,
                notes: document.getElementById('pressure-notes').value,
                status: calculatePressureStatus(pressureValue, room.pressureMin),
                userId: currentUser.uid,
                userName: currentUser.name,
                createdAt: new Date()
            };

            try {
                await db.collection('pressure_readings').add(data);
                await addTraceability(
                    'Registro de pressão', 
                    `${data.roomName}: ${data.pressure} Pa`
                );
                
                alert('Dados de pressão registrados com sucesso!');
                clearPressureForm();
                loadPressureHistory();
                
            } catch (error) {
                console.error('Erro ao salvar pressão:', error);
                alert('Erro ao salvar dados de pressão: ' + error.message);
            }
        }

        async function saveOsmosisDaily() {
            if (!currentUser) return;

            const conductivity = parseFloat(document.getElementById('condutividade').value);

            if (isNaN(conductivity)) {
                alert('Por favor, preencha o campo de condutividade com um valor numérico válido.');
                return;
            }

            const data = {
                conductivity: conductivity,
                lastSanitization: document.getElementById('ultima-sanitizacao').value,
                nextSanitization: document.getElementById('proxima-sanitizacao').value,
                lastCleaning: document.getElementById('ultima-higienizacao').value,
                nextCleaning: document.getElementById('proxima-higienizacao').value,
                lastCollection: document.getElementById('ultima-coleta').value,
                nextCollection: document.getElementById('proxima-coleta').value,
                hasAbnormality: document.querySelector('input[name="anormalidade"]:checked').value === 'sim',
                abnormalityReason: document.getElementById('motivo-anormalidade').value,
                lastFilterChange: {
                    fpp001: document.getElementById('ultima-fpp001').value,
                    fca001: document.getElementById('ultima-fca001').value,
                    drm001: document.getElementById('ultima-drm001').value,
                    drm002: document.getElementById('ultima-drm002').value
                },
                nextFilterChange: {
                    fpp001: document.getElementById('proxima-fpp001').value,
                    fca001: document.getElementById('proxima-fca001').value,
                    drm001: document.getElementById('proxima-drm001').value,
                    drm002: document.getElementById('proxima-drm002').value
                },
                notes: document.getElementById('osmosis-daily-notes').value,
                userId: currentUser.uid,
                userName: currentUser.name,
                createdAt: new Date()
            };

            try {
                await db.collection('osmosis_daily').add(data);
                await addTraceability(
                    'Controle diário de osmose', 
                    `Condutividade: ${data.conductivity} µS/cm`
                );
                
                alert('Controle diário do sistema de osmose registrado com sucesso!');
                clearOsmosisDailyForm();
                loadOsmosisHistory();
                
            } catch (error) {
                console.error('Erro ao salvar osmose diária:', error);
                alert('Erro ao salvar dados de osmose diária: ' + error.message);
            }
        }

        async function saveOsmosisMaintenance() {
            if (!currentUser) return;
            
            const procedure = document.getElementById('procedimento').value;
            const maintenanceDate = document.getElementById('data-manutencao').value;

            if (!procedure || !maintenanceDate) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            const data = {
                procedure: procedure,
                maintenanceDate: maintenanceDate,
                observations: document.getElementById('obs-manutencao').value,
                userId: currentUser.uid,
                userName: currentUser.name,
                createdAt: new Date()
            };

            try {
                await db.collection('osmosis_maintenance').add(data);
                await addTraceability(
                    'Manutenção de osmose', 
                    `Procedimento: ${data.procedure.substring(0, 50)}...`
                );
                
                alert('Manutenção do sistema de osmose registrada com sucesso!');
                clearMaintenanceForm();
                loadMaintenanceHistory();
                
            } catch (error) {
                console.error('Erro ao salvar manutenção de osmose:', error);
                alert('Erro ao salvar dados de manutenção: ' + error.message);
            }
        }

        async function addRoom() {
            if (currentUser.role !== 'admin') {
                alert('Apenas administradores podem adicionar salas.');
                return;
            }

            const code = document.getElementById('room-code').value;
            const name = document.getElementById('room-name').value;
            const responsible = document.getElementById('room-responsible').value;
            const tempMin = parseFloat(document.getElementById('temp-min-room').value);
            const tempMax = parseFloat(document.getElementById('temp-max-room').value);
            const humidityMin = parseFloat(document.getElementById('umid-min-room').value);
            const humidityMax = parseFloat(document.getElementById('umid-max-room').value);
            const pressureMin = parseInt(document.getElementById('pressure-value-min').value);

            if (!code || !name || !responsible || isNaN(tempMin) || isNaN(tempMax) || 
                isNaN(humidityMin) || isNaN(humidityMax) || isNaN(pressureMin)) {
                alert('Por favor, preencha todos os campos obrigatórios com valores válidos.');
                return;
            }

            const data = {
                code: code,
                name: name,
                type: document.getElementById('room-type').value,
                responsible: responsible,
                tempMin: tempMin,
                tempMax: tempMax,
                humidityMin: humidityMin,
                humidityMax: humidityMax,
                pressureMin: pressureMin,
                description: document.getElementById('room-description').value,
                status: 'active',
                createdAt: new Date(),
                createdBy: currentUser.uid,
                createdByName: currentUser.name
            };

            try {
                await db.collection('rooms').add(data);
                await addTraceability(
                    'Adição de sala', 
                    `${data.name} (${data.code}) adicionada`
                );
                
                alert('Sala adicionada com sucesso!');
                clearRoomForm();
                await loadRooms(); // Recarregar salas
                loadRoomsList(); // Recarregar lista
                
            } catch (error) {
                console.error('Erro ao adicionar sala:', error);
                alert('Erro ao adicionar sala: ' + error.message);
            }
        }

        // ========== FUNÇÕES DE EDIÇÃO E EXCLUSÃO ==========

        async function editTemperatureReading(docId) {
            try {
                const doc = await db.collection('temperature_readings').doc(docId).get();
                if (!doc.exists) {
                    alert('Registro não encontrado!');
                    return;
                }

                const data = doc.data();
                currentEditData = { collection: 'temperature_readings', id: docId, data: data };

                const modalContent = `
                    <div class="form-group">
                        <label for="edit-temp-min">Temperatura Mínima (°C):</label>
                        <input type="number" id="edit-temp-min" step="0.1" value="${data.tempMin || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-temp-max">Temperatura Máxima (°C):</label>
                        <input type="number" id="edit-temp-max" step="0.1" value="${data.tempMax || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-temp-atual">Temperatura Atual (°C):</label>
                        <input type="number" id="edit-temp-atual" step="0.1" value="${data.tempActual || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-umid-min">Umidade Mínima (%):</label>
                        <input type="number" id="edit-umid-min" step="0.1" value="${data.humidityMin || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-umid-max">Umidade Máxima (%):</label>
                        <input type="number" id="edit-umid-max" step="0.1" value="${data.humidityMax || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-umid-atual">Umidade Atual (%):</label>
                        <input type="number" id="edit-umid-atual" step="0.1" value="${data.humidityActual || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-temp-notes">Observações:</label>
                        <textarea id="edit-temp-notes" rows="3">${data.notes || ''}</textarea>
                    </div>
                `;

                document.getElementById('edit-modal-title').textContent = 'Editar Leitura de Temperatura';
                document.getElementById('edit-modal-content').innerHTML = modalContent;
                showEditModal();

            } catch (error) {
                console.error('Erro ao carregar dados para edição:', error);
                alert('Erro ao carregar dados para edição');
            }
        }

        async function editPressureReading(docId) {
            try {
                const doc = await db.collection('pressure_readings').doc(docId).get();
                if (!doc.exists) {
                    alert('Registro não encontrado!');
                    return;
                }

                const data = doc.data();
                currentEditData = { collection: 'pressure_readings', id: docId, data: data };

                const modalContent = `
                    <div class="form-group">
                        <label for="edit-pressure-value">Pressão (Pa):</label>
                        <input type="number" id="edit-pressure-value" step="1" value="${data.pressure || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-correcao-imediata">Correção Imediata:</label>
                        <textarea id="edit-correcao-imediata" rows="3">${data.immediateCorrection || ''}</textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-pressure-notes">Observações:</label>
                        <textarea id="edit-pressure-notes" rows="3">${data.notes || ''}</textarea>
                    </div>
                `;

                document.getElementById('edit-modal-title').textContent = 'Editar Leitura de Pressão';
                document.getElementById('edit-modal-content').innerHTML = modalContent;
                showEditModal();

            } catch (error) {
                console.error('Erro ao carregar dados para edição:', error);
                alert('Erro ao carregar dados para edição');
            }
        }

        async function editRoom(docId) {
            try {
                const doc = await db.collection('rooms').doc(docId).get();
                if (!doc.exists) {
                    alert('Sala não encontrada!');
                    return;
                }

                const data = doc.data();
                currentEditData = { collection: 'rooms', id: docId, data: data };

                const modalContent = `
                    <div class="form-group">
                        <label for="edit-room-name">Nome da Sala:</label>
                        <input type="text" id="edit-room-name" value="${data.name || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-room-code">Código da Sala:</label>
                        <input type="text" id="edit-room-code" value="${data.code || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-room-type">Tipo de Sala:</label>
                        <select id="edit-room-type">
                            <option value="estoque" ${data.type === 'estoque' ? 'selected' : ''}>Estoque</option>
                            <option value="preparacao" ${data.type === 'preparacao' ? 'selected' : ''}>Preparação</option>
                            <option value="producao" ${data.type === 'producao' ? 'selected' : ''}>Produção</option>
                            <option value="embalagem" ${data.type === 'embalagem' ? 'selected' : ''}>Embalagem</option>
                            <option value="qualidade" ${data.type === 'qualidade' ? 'selected' : ''}>Controle de Qualidade</option>
                            <option value="outro" ${data.type === 'outro' ? 'selected' : ''}>Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="edit-room-responsible">Responsável:</label>
                        <input type="text" id="edit-room-responsible" value="${data.responsible || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-temp-min-room">Temperatura Mínima (°C):</label>
                        <input type="number" id="edit-temp-min-room" step="0.1" value="${data.tempMin || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-temp-max-room">Temperatura Máxima (°C):</label>
                        <input type="number" id="edit-temp-max-room" step="0.1" value="${data.tempMax || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-umid-min-room">Umidade Mínima (%):</label>
                        <input type="number" id="edit-umid-min-room" step="0.1" value="${data.humidityMin || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-umid-max-room">Umidade Máxima (%):</label>
                        <input type="number" id="edit-umid-max-room" step="0.1" value="${data.humidityMax || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-pressure-value-min">Pressão Mínima (Pa):</label>
                        <input type="number" id="edit-pressure-value-min" value="${data.pressureMin || ''}">
                    </div>
                    <div class="form-group">
                        <label for="edit-room-description">Descrição:</label>
                        <textarea id="edit-room-description" rows="3">${data.description || ''}</textarea>
                    </div>
                `;

                document.getElementById('edit-modal-title').textContent = 'Editar Sala';
                document.getElementById('edit-modal-content').innerHTML = modalContent;
                showEditModal();

            } catch (error) {
                console.error('Erro ao carregar dados para edição:', error);
                alert('Erro ao carregar dados para edição');
            }
        }

        async function saveEdit() {
            if (!currentEditData) return;

            try {
                let updateData = {};
                const room = rooms.find(r => r.id === currentEditData.data.roomId);

                switch(currentEditData.collection) {
                    case 'temperature_readings':
                        updateData = {
                            tempMin: parseFloat(document.getElementById('edit-temp-min').value),
                            tempMax: parseFloat(document.getElementById('edit-temp-max').value),
                            tempActual: parseFloat(document.getElementById('edit-temp-atual').value),
                            humidityMin: parseFloat(document.getElementById('edit-umid-min').value),
                            humidityMax: parseFloat(document.getElementById('edit-umid-max').value),
                            humidityActual: parseFloat(document.getElementById('edit-umid-atual').value),
                            notes: document.getElementById('edit-temp-notes').value,
                            status: calculateTemperatureStatus(
                                parseFloat(document.getElementById('edit-temp-atual').value),
                                parseFloat(document.getElementById('edit-umid-atual').value),
                                room?.tempMin,
                                room?.tempMax,
                                room?.humidityMin,
                                room?.humidityMax
                            ),
                            updatedAt: new Date(),
                            updatedBy: currentUser.uid,
                            updatedByName: currentUser.name
                        };
                        break;

                    case 'pressure_readings':
                        updateData = {
                            pressure: parseInt(document.getElementById('edit-pressure-value').value),
                            immediateCorrection: document.getElementById('edit-correcao-imediata').value,
                            notes: document.getElementById('edit-pressure-notes').value,
                            status: calculatePressureStatus(
                                parseInt(document.getElementById('edit-pressure-value').value),
                                room?.pressureMin
                            ),
                            updatedAt: new Date(),
                            updatedBy: currentUser.uid,
                            updatedByName: currentUser.name
                        };
                        break;

                    case 'rooms':
                        updateData = {
                            name: document.getElementById('edit-room-name').value,
                            code: document.getElementById('edit-room-code').value,
                            type: document.getElementById('edit-room-type').value,
                            responsible: document.getElementById('edit-room-responsible').value,
                            tempMin: parseFloat(document.getElementById('edit-temp-min-room').value),
                            tempMax: parseFloat(document.getElementById('edit-temp-max-room').value),
                            humidityMin: parseFloat(document.getElementById('edit-umid-min-room').value),
                            humidityMax: parseFloat(document.getElementById('edit-umid-max-room').value),
                            pressureMin: parseInt(document.getElementById('edit-pressure-value-min').value),
                            description: document.getElementById('edit-room-description').value,
                            updatedAt: new Date(),
                            updatedBy: currentUser.uid,
                            updatedByName: currentUser.name
                        };
                        break;
                }

                await db.collection(currentEditData.collection).doc(currentEditData.id).update(updateData);
                
                await addTraceability(
                    `Edição de ${currentEditData.collection.replace('_', ' ')}`, 
                    `Registro ${currentEditData.id} atualizado`
                );

                alert('Registro atualizado com sucesso!');
                hideEditModal();
                
                // Recarregar dados
                switch(currentEditData.collection) {
                    case 'temperature_readings':
                        loadTemperatureHistory();
                        break;
                    case 'pressure_readings':
                        loadPressureHistory();
                        break;
                    case 'rooms':
                        loadRoomsList();
                        loadRooms(); // Para atualizar os selects
                        break;
                }

            } catch (error) {
                console.error('Erro ao salvar edição:', error);
                alert('Erro ao salvar edição: ' + error.message);
            }
        }

        async function deleteRecord(collection, docId, confirmationMessage) {
            if (!confirm(confirmationMessage || 'Tem certeza que deseja excluir este registro?')) {
                return;
            }

            try {
                await db.collection(collection).doc(docId).delete();
                
                await addTraceability(
                    `Exclusão de ${collection.replace('_', ' ')}`, 
                    `Registro ${docId} excluído`
                );

                alert('Registro excluído com sucesso!');
                
                // Recarregar dados
                switch(collection) {
                    case 'temperature_readings':
                        loadTemperatureHistory();
                        break;
                    case 'pressure_readings':
                        loadPressureHistory();
                        break;
                    case 'rooms':
                        loadRoomsList();
                        loadRooms(); // Para atualizar os selects
                        break;
                    case 'osmosis_daily':
                        loadOsmosisHistory();
                        break;
                    case 'osmosis_maintenance':
                        loadMaintenanceHistory();
                        break;
                }

            } catch (error) {
                console.error('Erro ao excluir registro:', error);
                alert('Erro ao excluir registro: ' + error.message);
            }
        }

        // ========== GERENCIAMENTO DE USUÁRIOS ==========

        async function addUser() {
            if (currentUser.role !== 'admin') {
                alert('Apenas administradores podem adicionar usuários.');
                return;
            }

            const name = document.getElementById('user-name').value;
            const email = document.getElementById('user-email').value;
            const password = document.getElementById('user-password').value;
            const role = document.getElementById('user-role').value;

            if (!name || !email || !password) {
                alert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            // Validar formato do email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Por favor, insira um email válido.');
                return;
            }

            // Validar senha
            if (password.length < 6) {
                alert('A senha deve ter pelo menos 6 caracteres.');
                return;
            }

            // Verificar se o email já existe no Firestore
            try {
                const existingUsers = await db.collection('users')
                    .where('email', '==', email)
                    .get();
                
                if (!existingUsers.empty) {
                    alert('Este email já está cadastrado no sistema.');
                    return;
                }
            } catch (error) {
                console.error('Erro ao verificar email:', error);
            }

            // Desabilitar botão durante o processo
            const addButton = document.getElementById('add-user-btn');
            const originalText = addButton.innerHTML;
            addButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Criando usuário...';
            addButton.disabled = true;

            try {
                // Salvar o usuário atual antes de criar um novo
                const currentUserEmail = currentUser.email;
                const adminUser = auth.currentUser;
                
                // Criar usuário no Authentication
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const newUserId = userCredential.user.uid;
                
                // Salvar dados no Firestore
                const userData = {
                    name: name,
                    email: email,
                    role: role,
                    createdAt: new Date(),
                    status: 'active',
                    createdBy: currentUser.uid,
                    createdByName: currentUser.name
                };

                await db.collection('users').doc(newUserId).set(userData);
                
                // Fazer logout do usuário recém-criado
                await auth.signOut();
                
                // Aguardar um momento antes de relogar
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await addTraceability(
                    'Criação de usuário', 
                    `Usuário ${name} (${email}) criado como ${role}`
                );
                
                alert(`Usuário "${name}" criado com sucesso!\n\nEmail: ${email}\nSenha: ${password}\n\nVocê precisará fazer login novamente como administrador.`);
                clearUserForm();
                
                // Recarregar a página para forçar novo login
                window.location.reload();
                
            } catch (error) {
                console.error('Erro ao criar usuário:', error);
                alert('Erro ao criar usuário: ' + getAuthErrorMessage(error.code));
                
                // Restaurar botão
                addButton.innerHTML = originalText;
                addButton.disabled = false;
            }
        }

        async function loadUsersList() {
            try {
                const snapshot = await db.collection('users')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const tbody = document.getElementById('users-list');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Nenhum usuário cadastrado</td></tr>';
                    return;
                }
                
                allUsers = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    allUsers.push({ id: doc.id, ...data });
                    const row = createUserRow(data, doc.id);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar lista de usuários:', error);
                document.getElementById('users-list').innerHTML = '<tr><td colspan="6" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        function createUserRow(data, userId) {
            const row = document.createElement('tr');
            const createdAt = data.createdAt ? 
                new Date(data.createdAt).toLocaleDateString('pt-BR') : '-';
            
            row.innerHTML = `
                <td>${data.name || '-'}</td>
                <td>${data.email || '-'}</td>
                <td>${data.role === 'admin' ? 'Administrador' : 'Usuário Normal'}</td>
                <td>${createdAt}</td>
                <td><span class="status ${data.status === 'active' ? 'status-normal' : 'status-critical'}">${data.status === 'active' ? 'Ativo' : 'Inativo'}</span></td>
                <td>
                    <button class="btn btn-warning btn-sm" onclick="editUser('${userId}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteUser('${userId}')">
                        <i class="fas fa-trash"></i>
                    </button>
                    ${data.status === 'active' ? 
                        `<button class="btn btn-secondary btn-sm" onclick="deactivateUser('${userId}')">
                            <i class="fas fa-user-slash"></i>
                        </button>` :
                        `<button class="btn btn-success btn-sm" onclick="activateUser('${userId}')">
                            <i class="fas fa-user-check"></i>
                        </button>`
                    }
                </td>
            `;
            return row;
        }

        async function editUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            const newName = prompt('Novo nome:', user.name);
            if (!newName) return;

            const newRole = prompt('Novo tipo (admin/user):', user.role);
            if (!newRole || !['admin', 'user'].includes(newRole)) {
                alert('Tipo inválido. Use "admin" ou "user".');
                return;
            }

            try {
                await db.collection('users').doc(userId).update({
                    name: newName,
                    role: newRole
                });

                await addTraceability(
                    'Edição de usuário', 
                    `Usuário ${user.email} atualizado: nome="${newName}", tipo="${newRole}"`
                );

                alert('Usuário atualizado com sucesso!');
                loadUsersList();
            } catch (error) {
                console.error('Erro ao editar usuário:', error);
                alert('Erro ao editar usuário');
            }
        }

        async function deleteUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            if (!confirm(`Tem certeza que deseja excluir permanentemente o usuário ${user.name} (${user.email})?`)) {
                return;
            }

            try {
                // Deletar do Firestore
                await db.collection('users').doc(userId).delete();

                await addTraceability(
                    'Exclusão de usuário', 
                    `Usuário ${user.name} (${user.email}) excluído permanentemente`
                );

                alert('Usuário excluído com sucesso!');
                loadUsersList();
            } catch (error) {
                console.error('Erro ao excluir usuário:', error);
                alert('Erro ao excluir usuário: ' + error.message);
            }
        }

        async function deactivateUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            try {
                await db.collection('users').doc(userId).update({
                    status: 'inactive'
                });

                await addTraceability(
                    'Desativação de usuário', 
                    `Usuário ${user.name} (${user.email}) desativado`
                );

                alert('Usuário desativado com sucesso!');
                loadUsersList();
            } catch (error) {
                console.error('Erro ao desativar usuário:', error);
                alert('Erro ao desativar usuário');
            }
        }

        async function activateUser(userId) {
            const user = allUsers.find(u => u.id === userId);
            if (!user) return;

            try {
                await db.collection('users').doc(userId).update({
                    status: 'active'
                });

                await addTraceability(
                    'Ativação de usuário', 
                    `Usuário ${user.name} (${user.email}) ativado`
                );

                alert('Usuário ativado com sucesso!');
                loadUsersList();
            } catch (error) {
                console.error('Erro ao ativar usuário:', error);
                alert('Erro ao ativar usuário');
            }
        }

        function clearUserForm() {
            document.getElementById('user-name').value = '';
            document.getElementById('user-email').value = '';
            document.getElementById('user-password').value = '';
            document.getElementById('user-role').value = 'user';
        }

        // ========== FUNÇÕES PARA CARREGAR DADOS ==========

        async function loadTemperatureHistory() {
            try {
                const snapshot = await db.collection('temperature_readings')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                const tbody = document.getElementById('temp-history');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="12" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = createTemperatureRow(data, doc.id);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar histórico de temperatura:', error);
                document.getElementById('temp-history').innerHTML = '<tr><td colspan="12" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        async function loadPressureHistory() {
            try {
                const snapshot = await db.collection('pressure_readings')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                const tbody = document.getElementById('pressure-history');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = createPressureRow(data, doc.id);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar histórico de pressão:', error);
                document.getElementById('pressure-history').innerHTML = '<tr><td colspan="7" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        async function loadOsmosisHistory() {
            try {
                const snapshot = await db.collection('osmosis_daily')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                const tbody = document.getElementById('osmosis-history');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = createOsmosisRow(data, doc.id);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar histórico de osmose:', error);
                document.getElementById('osmosis-history').innerHTML = '<tr><td colspan="5" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        async function loadMaintenanceHistory() {
            try {
                const snapshot = await db.collection('osmosis_maintenance')
                    .orderBy('createdAt', 'desc')
                    .limit(50)
                    .get();
                
                const tbody = document.getElementById('maintenance-history');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = createMaintenanceRow(data, doc.id);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar histórico de manutenções:', error);
                document.getElementById('maintenance-history').innerHTML = '<tr><td colspan="5" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        async function loadRoomsList() {
            try {
                const snapshot = await db.collection('rooms')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const tbody = document.getElementById('rooms-list');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="9" style="text-align: center;">Nenhuma sala cadastrada</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = createRoomRow(data, doc.id);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar lista de salas:', error);
                document.getElementById('rooms-list').innerHTML = '<tr><td colspan="9" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        async function loadTraceabilityLog() {
            try {
                const snapshot = await db.collection('traceability')
                    .orderBy('createdAt', 'desc')
                    .limit(100)
                    .get();
                
                const tbody = document.getElementById('traceability-log');
                tbody.innerHTML = '';
                
                if (snapshot.empty) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center;">Nenhum registro encontrado</td></tr>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const row = createTraceabilityRow(data);
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Erro ao carregar log de rastreabilidade:', error);
                document.getElementById('traceability-log').innerHTML = '<tr><td colspan="5" style="text-align: center;">Erro ao carregar dados</td></tr>';
            }
        }

        // ========== FUNÇÕES PARA CRIAR LINHAS DE TABELA ==========

        function createTemperatureRow(data, docId) {
            const row = document.createElement('tr');
            const statusClass = `status-${data.status || 'normal'}`;
            const createdAt = data.createdAt ? 
                new Date(data.createdAt).toLocaleString('pt-BR') : '-';
            
            row.innerHTML = `
                <td>${createdAt}</td>
                <td>${data.roomName || '-'}</td>
                <td>${data.period || '-'}</td>
                <td>${data.tempMin || '-'}°C</td>
                <td>${data.tempMax || '-'}°C</td>
                <td>${data.tempActual || '-'}°C</td>
                <td>${data.humidityMin || '-'}%</td>
                <td>${data.humidityMax || '-'}%</td>
                <td>${data.humidityActual || '-'}%</td>
                <td><span class="status ${statusClass}">${getStatusText(data.status)}</span></td>
                <td>${data.userName || '-'}</td>
                <td class="admin-only">
                    <button class="btn btn-primary btn-sm" onclick="editTemperatureReading('${docId}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteRecord('temperature_readings', '${docId}', 'Tem certeza que deseja excluir esta leitura de temperatura?')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            return row;
        }

        function createPressureRow(data, docId) {
            const row = document.createElement('tr');
            const statusClass = `status-${data.status || 'normal'}`;
            const createdAt = data.createdAt ? 
                new Date(data.createdAt).toLocaleString('pt-BR') : '-';
            
            row.innerHTML = `
                <td>${createdAt}</td>
                <td>${data.roomName || '-'}</td>
                <td>${data.pressure || '-'} Pa</td>
                <td>${data.immediateCorrection || '-'}</td>
                <td><span class="status ${statusClass}">${getStatusText(data.status)}</span></td>
                <td>${data.userName || '-'}</td>
                <td class="admin-only">
                    <button class="btn btn-primary btn-sm" onclick="editPressureReading('${docId}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteRecord('pressure_readings', '${docId}', 'Tem certeza que deseja excluir esta leitura de pressão?')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            return row;
        }

        function createOsmosisRow(data, docId) {
            const row = document.createElement('tr');
            const createdAt = data.createdAt ? 
                new Date(data.createdAt).toLocaleString('pt-BR') : '-';
            
            row.innerHTML = `
                <td>${createdAt}</td>
                <td>${data.conductivity || '-'} µS/cm</td>
                <td>${data.hasAbnormality ? 'Sim' : 'Não'}</td>
                <td>${data.userName || '-'}</td>
                <td class="admin-only">
                    <button class="btn btn-primary btn-sm">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteRecord('osmosis_daily', '${docId}', 'Tem certeza que deseja excluir este registro de osmose?')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            return row;
        }

        function createMaintenanceRow(data, docId) {
            const row = document.createElement('tr');
            const maintenanceDate = data.maintenanceDate ? 
                new Date(data.maintenanceDate).toLocaleDateString('pt-BR') : '-';
            const createdAt = data.createdAt ? 
                new Date(data.createdAt).toLocaleString('pt-BR') : '-';
            
            row.innerHTML = `
                <td>${maintenanceDate}</td>
                <td>${data.procedure || '-'}</td>
                <td>${data.observations || '-'}</td>
                <td>${data.userName || '-'}</td>
                <td class="admin-only">
                    <button class="btn btn-primary btn-sm">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteRecord('osmosis_maintenance', '${docId}', 'Tem certeza que deseja excluir este registro de manutenção?')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            return row;
        }

        function createRoomRow(data, docId) {
            const row = document.createElement('tr');
            const statusClass = data.status === 'active' ? 'status-normal' : 'status-critical';
            const statusText = data.status === 'active' ? 'Ativa' : 'Inativa';
            
            row.innerHTML = `
                <td>${data.code || '-'}</td>
                <td>${data.name || '-'}</td>
                <td>${formatRoomType(data.type)}</td>
                <td>${data.responsible || '-'}</td>
                <td>${data.tempMin || '-'}°C - ${data.tempMax || '-'}°C</td>
                <td>${data.humidityMin || '-'}% - ${data.humidityMax || '-'}%</td>
                <td>${data.pressureMin || '-'} Pa</td>
                <td><span class="status ${statusClass}">${statusText}</span></td>
                <td>
                    <button class="btn btn-primary btn-sm" onclick="editRoom('${docId}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteRecord('rooms', '${docId}', 'Tem certeza que deseja excluir esta sala?')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            `;
            return row;
        }

        function createTraceabilityRow(data) {
            const row = document.createElement('tr');
            const createdAt = data.createdAt ? 
                new Date(data.createdAt).toLocaleString('pt-BR') : '-';
            
            row.innerHTML = `
                <td>${createdAt}</td>
                <td>${data.userName || '-'}</td>
                <td>${data.action || '-'}</td>
                <td>${data.details || '-'}</td>
                <td>${data.userIp || '-'}</td>
            `;
            return row;
        }

        // ========== FUNÇÕES AUXILIARES ==========

        function calculateTemperatureStatus(temperature, humidity, tempMin, tempMax, humidityMin, humidityMax) {
            if (!tempMin || !tempMax || !humidityMin || !humidityMax) {
                return 'normal'; // Fallback se não houver parâmetros definidos
            }

            const tempInRange = temperature >= tempMin && temperature <= tempMax;
            const humidityInRange = humidity >= humidityMin && humidity <= humidityMax;

            if (tempInRange && humidityInRange) {
                return 'normal';
            } else if ((temperature >= tempMin - 1 && temperature <= tempMax + 1) || 
                       (humidity >= humidityMin - 5 && humidity <= humidityMax + 5)) {
                return 'alert';
            } else {
                return 'critical';
            }
        }

        function calculatePressureStatus(pressure, minPressure) {
            if (!minPressure) return 'normal'; // Fallback

            if (pressure >= minPressure) {
                return 'normal';
            } else if (pressure >= minPressure - 2) {
                return 'alert';
            } else {
                return 'critical';
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'normal': 'Normal',
                'alert': 'Alerta', 
                'critical': 'Crítico'
            };
            return statusMap[status] || status;
        }

        function formatRoomType(type) {
            const types = {
                'estoque': 'Estoque',
                'preparacao': 'Preparação',
                'producao': 'Produção',
                'embalagem': 'Embalagem',
                'qualidade': 'Controle de Qualidade',
                'outro': 'Outro'
            };
            return types[type] || type;
        }

        // Função auxiliar para adicionar rastreabilidade
        async function addTraceability(action, details) {
            try {
                await db.collection('traceability').add({
                    action: action,
                    details: details,
                    userId: currentUser.uid,
                    userName: currentUser.name,
                    userIp: await getUserIP(),
                    createdAt: new Date()
                });
                // Recarregar o log de rastreabilidade
                if (currentUser.role === 'admin') {
                    loadTraceabilityLog();
                }
            } catch (error) {
                console.error('Erro ao registrar rastreabilidade:', error);
            }
        }

        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'IP não disponível';
            }
        }

        function getAuthErrorMessage(errorCode) {
            console.log('Código de erro:', errorCode);
            
            const messages = {
                'auth/invalid-email': 'Email inválido',
                'auth/user-disabled': 'Usuário desativado',
                'auth/user-not-found': 'Usuário não encontrado',
                'auth/wrong-password': 'Senha incorreta',
                'auth/too-many-requests': 'Muitas tentativas. Tente novamente mais tarde.',
                'auth/network-request-failed': 'Erro de conexão. Verifique sua internet.',
                'auth/internal-error': 'Erro interno do servidor'
            };
            
            return messages[errorCode] || `Erro desconhecido: ${errorCode}`;
        }

        // Funções para limpar formulários
        function clearTemperatureForm() {
            document.getElementById('temp-min').value = '';
            document.getElementById('temp-max').value = '';
            document.getElementById('temp-atual').value = '';
            document.getElementById('umid-min').value = '';
            document.getElementById('umid-max').value = '';
            document.getElementById('umid-atual').value = '';
            document.getElementById('temp-notes').value = '';
        }

        function clearPressureForm() {
            document.getElementById('pressure-value').value = '';
            document.getElementById('correcao-imediata').value = '';
            document.getElementById('pressure-notes').value = '';
        }

        function clearOsmosisDailyForm() {
            document.getElementById('condutividade').value = '';
            document.getElementById('ultima-sanitizacao').value = '';
            document.getElementById('proxima-sanitizacao').value = '';
            document.getElementById('ultima-higienizacao').value = '';
            document.getElementById('proxima-higienizacao').value = '';
            document.getElementById('ultima-coleta').value = '';
            document.getElementById('proxima-coleta').value = '';
            document.getElementById('anormalidade-nao').checked = true;
            document.getElementById('anormalidade-detalhes').style.display = 'none';
            document.getElementById('motivo-anormalidade').value = '';
            document.getElementById('ultima-fpp001').value = '';
            document.getElementById('ultima-fca001').value = '';
            document.getElementById('ultima-drm001').value = '';
            document.getElementById('ultima-drm002').value = '';
            document.getElementById('proxima-fpp001').value = '';
            document.getElementById('proxima-fca001').value = '';
            document.getElementById('proxima-drm001').value = '';
            document.getElementById('proxima-drm002').value = '';
            document.getElementById('osmosis-daily-notes').value = '';
        }

        function clearMaintenanceForm() {
            document.getElementById('procedimento').value = '';
            document.getElementById('data-manutencao').value = '';
            document.getElementById('obs-manutencao').value = '';
        }

        function clearRoomForm() {
            document.getElementById('room-name').value = '';
            document.getElementById('room-code').value = '';
            document.getElementById('room-type').value = 'estoque';
            document.getElementById('room-responsible').value = '';
            document.getElementById('temp-min-room').value = '18.0';
            document.getElementById('temp-max-room').value = '26.0';
            document.getElementById('umid-min-room').value = '40.0';
            document.getElementById('umid-max-room').value = '60.0';
            document.getElementById('pressure-value-min').value = '5';
            document.getElementById('room-description').value = '';
        }

        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'flex';
        }

        function hideLoginModal() {
            document.getElementById('login-modal').style.display = 'none';
        }

        function showEditModal() {
            document.getElementById('edit-modal').style.display = 'flex';
        }

        function hideEditModal() {
            document.getElementById('edit-modal').style.display = 'none';
            currentEditData = null;
        }

        // Atualizar hora atual
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                `Data: ${now.toLocaleDateString('pt-BR')} Hora: ${now.toLocaleTimeString('pt-BR')}`;
        }

        // Funções de exportação PDF
        async function exportToPDF(type) {
            if (currentUser.role !== 'admin') {
                alert('Apenas administradores podem exportar relatórios em PDF.');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(16);
            doc.text(`Relatório de ${getReportTitle(type)}`, 14, 15);
            
            // Add date
            doc.setFontSize(10);
            doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 14, 22);
            doc.text(`Gerado por: ${currentUser.name}`, 14, 28);
            
            try {
                let headers = [];
                let data = [];
                
                switch(type) {
                    case 'temperature':
                        headers = [['Data/Hora', 'Sala', 'Período', 'Temp. Mín', 'Temp. Máx', 'Temp. Atual', 'Umid. Mín', 'Umid. Máx', 'Umid. Atual', 'Status']];
                        const tempSnapshot = await db.collection('temperature_readings')
                            .orderBy('createdAt', 'desc')
                            .limit(100)
                            .get();
                        
                        tempSnapshot.forEach(doc => {
                            const item = doc.data();
                            const date = item.createdAt ? new Date(item.createdAt).toLocaleString('pt-BR') : '-';
                            data.push([
                                date,
                                item.roomName || '-',
                                item.period || '-',
                                `${item.tempMin || '-'}°C`,
                                `${item.tempMax || '-'}°C`,
                                `${item.tempActual || '-'}°C`,
                                `${item.humidityMin || '-'}%`,
                                `${item.humidityMax || '-'}%`,
                                `${item.humidityActual || '-'}%`,
                                getStatusText(item.status)
                            ]);
                        });
                        break;
                        
                    case 'pressure':
                        headers = [['Data/Hora', 'Sala', 'Pressão (Pa)', 'Correção', 'Status']];
                        const pressureSnapshot = await db.collection('pressure_readings')
                            .orderBy('createdAt', 'desc')
                            .limit(100)
                            .get();
                        
                        pressureSnapshot.forEach(doc => {
                            const item = doc.data();
                            const date = item.createdAt ? new Date(item.createdAt).toLocaleString('pt-BR') : '-';
                            data.push([
                                date,
                                item.roomName || '-',
                                item.pressure || '-',
                                item.immediateCorrection || '-',
                                getStatusText(item.status)
                            ]);
                        });
                        break;
                        
                    case 'rooms':
                        headers = [['Código', 'Nome', 'Tipo', 'Responsável', 'Temp. Min-Max', 'Umid. Min-Max', 'Pressão Mínima', 'Status']];
                        const roomsSnapshot = await db.collection('rooms').get();
                        
                        roomsSnapshot.forEach(doc => {
                            const item = doc.data();
                            data.push([
                                item.code || '-',
                                item.name || '-',
                                formatRoomType(item.type),
                                item.responsible || '-',
                                `${item.tempMin || '-'}°C - ${item.tempMax || '-'}°C`,
                                `${item.humidityMin || '-'}% - ${item.humidityMax || '-'}%`,
                                `${item.pressureMin || '-'} Pa`,
                                item.status === 'active' ? 'Ativa' : 'Inativa'
                            ]);
                        });
                        break;

                    case 'users':
                        headers = [['Nome', 'Email', 'Tipo', 'Data de Criação', 'Status']];
                        const usersSnapshot = await db.collection('users').get();
                        
                        usersSnapshot.forEach(doc => {
                            const item = doc.data();
                            const date = item.createdAt ? new Date(item.createdAt).toLocaleDateString('pt-BR') : '-';
                            data.push([
                                item.name || '-',
                                item.email || '-',
                                item.role === 'admin' ? 'Administrador' : 'Usuário Normal',
                                date,
                                item.status === 'active' ? 'Ativo' : 'Inativo'
                            ]);
                        });
                        break;
                }
                
                // Generate table
                doc.autoTable({
                    head: headers,
                    body: data,
                    startY: 35,
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [44, 62, 80] }
                });
                
                // Save the PDF
                doc.save(`relatorio_${type}_${new Date().toISOString().slice(0, 10)}.pdf`);
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Erro ao gerar relatório PDF');
            }
        }

        function generateReport() {
            if (currentUser.role !== 'admin') {
                alert('Apenas administradores podem gerar relatórios personalizados.');
                return;
            }
            
            const reportType = document.getElementById('report-type').value;
            const startDate = document.getElementById('report-start-date').value;
            const endDate = document.getElementById('report-end-date').value;
            const format = document.getElementById('report-format').value;
            
            if (format === 'pdf') {
                exportToPDF(reportType);
            } else {
                alert('Relatório CSV gerado com sucesso! (Funcionalidade de demonstração)');
            }
        }

        function getReportTitle(type) {
            const titles = {
                'temperature': 'Temperatura e Umidade',
                'pressure': 'Pressão',
                'osmosis': 'Sistema de Osmose',
                'rooms': 'Salas',
                'users': 'Usuários',
                'traceability': 'Rastreabilidade',
                'maintenance': 'Manutenções de Osmose'
            };
            return titles[type] || type;
        }

        function filterTraceability() {
            // Implementação básica de filtro
            const filterDate = document.getElementById('filter-date').value;
            const filterUser = document.getElementById('filter-user').value;
            const filterAction = document.getElementById('filter-action').value;
            
            console.log('Filtrando:', { filterDate, filterUser, filterAction });
            // Em uma implementação real, você faria uma query filtrada no Firestore
            loadTraceabilityLog(); // Recarrega todos os dados por enquanto
        }

        // Criar usuário admin automaticamente se não existir
        async function createAdminUserIfNotExists() {
            try {
                const usersSnapshot = await db.collection('users')
                    .where('role', '==', 'admin')
                    .limit(1)
                    .get();

                if (usersSnapshot.empty) {
                    // Tentar criar admin
                    try {
                        const userCredential = await auth.createUserWithEmailAndPassword('admin@labmonitor.com', '123456');
                        const adminData = {
                            name: 'Administrador',
                            email: 'admin@labmonitor.com',
                            role: 'admin',
                            createdAt: new Date(),
                            status: 'active'
                        };
                        await db.collection('users').doc(userCredential.user.uid).set(adminData);
                        console.log('Usuário admin criado automaticamente');
                    } catch (error) {
                        console.log('Admin já existe ou erro ao criar:', error);
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar admin:', error);
            }
        }

        // Executar na inicialização
        createAdminUserIfNotExists();
    </script>
</body>
</html>